!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("core-js/modules/es.array.fill"),require("core-js/modules/es.function.bind"),require("core-js/modules/es.parse-int")):"function"==typeof define&&define.amd?define(["core-js/modules/es.array.fill","core-js/modules/es.function.bind","core-js/modules/es.parse-int"],e):(t=t||self).ScratchCard=e()}(this,function(){"use strict";function a(t,e){for(var i=0;i<e.length;i++){var s=e[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}return function(){function e(t){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),this.canvas=t.canvas,this.showAllPercent=t.showAllPercent||80,this.radius=t.radius||20,this.coverColor=t.coverColor||"#666",this.coverImg=t.coverImg,this.callback=t.callback,this.ctx=null,this.offsetX=0,this.offsetY=0,this.hasDone=!1,this.devicePixelRatio=window.devicePixelRatio,this.animationFrameId=null,this.init()}var t,i,s;return t=e,(i=[{key:"init",value:function(){var t,e=this;this.ctx=this.canvas.getContext("2d"),this.offsetX=this.canvas.offsetLeft,this.offsetY=this.canvas.offsetTop,this.addEvent(),this.coverImg?((t=new Image).setAttribute("src",this.coverImg),t.setAttribute("crossOrigin","anonymous"),t.onload=function(){e.ctx.drawImage(t,0,0),e.ctx.globalCompositeOperation="destination-out"}):(this.ctx.fillStyle=this.coverColor,this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height),this.ctx.globalCompositeOperation="destination-out")}},{key:"addEvent",value:function(){this.canvas.addEventListener("touchmove",this.scratchEvent.bind(this),{passive:!1})}},{key:"scratchEvent",value:function(t){var e,i,s,a,n,o;t.preventDefault(),this.hasDone||t.changedTouches&&(i=(e=t.changedTouches[t.changedTouches.length-1]).clientX,s=e.clientY,n=(a=[parseInt(String(i-this.offsetX)),parseInt(String(s-this.offsetY))])[0],o=a[1],this.ctx.beginPath(),this.ctx.arc(n,o,this.radius*this.devicePixelRatio,0,2*Math.PI),this.ctx.fill(),this.getFulledPercentage()>this.showAllPercent&&(this.hasDone=!0,window.requestAnimationFrame(this.randomDrawArc.bind(this))))}},{key:"getFulledPercentage",value:function(){for(var t=this.ctx.getImageData(0,0,this.canvas.width,this.canvas.height).data,e=[],i=0;i<t.length;i+=4)t[i+3]<128&&e.push(t[i+3]);return e.length/(t.length/4)*100}},{key:"randomDrawArc",value:function(){var t=Math.random()*this.canvas.width,e=Math.random()*this.canvas.height;if(this.ctx.beginPath(),this.ctx.arc(t,e,this.radius*this.devicePixelRatio,0,2*Math.PI),this.ctx.fill(),90<this.getFulledPercentage())return this.animationFrameId&&window.cancelAnimationFrame(this.animationFrameId),this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height),void(this.callback&&"function"==typeof this.callback&&this.callback());this.getFulledPercentage()>this.showAllPercent&&(this.animationFrameId=window.requestAnimationFrame(this.randomDrawArc.bind(this)))}}])&&a(t.prototype,i),s&&a(t,s),e}()});
